<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Blockly Python Runner جاهزة</title>

<!-- مكتبات Blockly مضمنة -->
<script src="https://unpkg.com/blockly/blockly.min.js"></script>

<style>
body {
  font-family: "Cairo", sans-serif;
  direction: rtl;
  margin: 0;
  text-align: center;
  background: #f5f6fa;
}
h2 {
  background: #4b7bec;
  color: white;
  margin: 0;
  padding: 15px;
}
#main { display: flex; justify-content: center; flex-wrap: wrap; margin: 20px; }
#blocklyDiv { height: 520px; width: 700px; border: 2px solid #ccc; border-radius: 10px; background: white; }
#rightPanel { margin-right: 20px; display: flex; flex-direction: column; align-items: center; }
button { margin: 5px; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; background: #4b7bec; color: white; }
#clearBtn { background: #fc5c65; }
#output { margin-top: 10px; width: 400px; height: 220px; border: 2px solid #ccc; background: #fff; padding: 10px; overflow-y: auto; text-align: left; white-space: pre-wrap; font-family: monospace; border-radius: 8px; }
</style>
</head>
<body>

<h2>Blockly Python Runner جاهزة للعمل</h2>

<div id="main">
  <div id="blocklyDiv"></div>
  <div id="rightPanel">
    <button id="runBtn">▶️ تشغيل الكود</button>
    <button id="clearBtn">🧹 مسح الإخراج</button>
    <div id="output"></div>
  </div>
</div>

<script>
// إنشاء Workspace
const workspace = Blockly.inject('blocklyDiv', {
  toolbox: `
<xml xmlns="https://developers.google.com/blockly/xml">
  <category name="طباعة" colour="#5CA699">
    <block type="text_print"></block>
  </category>
  <category name="قيم ونصوص" colour="#5C81A6">
    <block type="math_number"></block>
    <block type="text"></block>
    <block type="variables_get"></block>
    <block type="variables_set"></block>
  </category>
  <category name="التحكم" colour="#A65C81">
    <block type="controls_if"></block>
    <block type="controls_repeat_ext">
      <value name="TIMES"><shadow type="math_number"><field name="NUM">5</field></shadow></value>
    </block>
  </category>
</xml>
`
});

// تخزين المتغيرات
let variables = {};

// تنفيذ كود Python المحاكى بواسطة JS
function runPythonJS(code) {
  const output = document.getElementById("output");
  const lines = code.split("\n");
  lines.forEach(line => {
    line = line.trim();
    if(line.startsWith("print(") && line.endsWith(")")) {
      let content = line.slice(6, -1).trim();
      if(content.startsWith('"') && content.endsWith('"') || content.startsWith("'") && content.endsWith("'")) {
        content = content.slice(1, -1);
      } else if(variables[content] !== undefined) {
        content = variables[content];
      }
      output.innerHTML += content + "\n";
    } else if(line.includes("=")) {
      let parts = line.split("=");
      let varName = parts[0].trim();
      let value = parts[1].trim();
      if(value.startsWith('"') && value.endsWith('"') || value.startsWith("'") && value.endsWith("'")) {
        value = value.slice(1, -1);
      } else if(!isNaN(Number(value))) {
        value = Number(value);
      } else if(variables[value] !== undefined) {
        value = variables[value];
      }
      variables[varName] = value;
    } else if(line.startsWith("for ") && line.includes(" in range(")) {
      const match = line.match(/for\s+(\w+)\s+in range\((\d+)\)/);
      if(match) {
        const loopVar = match[1];
        const count = parseInt(match[2]);
        const loopIndex = lines.indexOf(line);
        let loopBody = [];
        let indent = line.search(/\S/)+2;
        for(let i=loopIndex+1;i<lines.length;i++){
          const l = lines[i];
          if(l.startsWith(" ".repeat(indent))) loopBody.push(l.slice(indent));
          else break;
        }
        for(let j=0;j<count;j++){
          variables[loopVar] = j;
          runPythonJS(loopBody.join("\n"));
        }
      }
    }
  });
}

document.getElementById("runBtn").addEventListener("click", () => {
  const code = Blockly.Python.workspaceToCode(workspace);
  runPythonJS(code);
});

document.getElementById("clearBtn").addEventListener("click", () => {
  document.getElementById("output").innerHTML = "";
  variables = {};
});
</script>

</body>
</html>
