<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Python Blocks Runner Ù…Ø¹ Skulpt</title>

<!-- Ù…ÙƒØªØ¨Ø§Øª Blockly -->
<script src="https://unpkg.com/blockly/blockly.min.js"></script>

<!-- Ù…ÙƒØªØ¨Ø§Øª Skulpt -->
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>

<style>
body {
    font-family: "Cairo", sans-serif;
    direction: rtl;
    background: #f5f6fa;
    margin: 0;
    text-align: center;
}
h2 {
    background: #4b7bec;
    color: white;
    margin: 0;
    padding: 15px;
}
#main {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin: 20px;
}
#blocklyDiv {
    height: 520px;
    width: 700px;
    border: 2px solid #ccc;
    border-radius: 10px;
    background: white;
}
#rightPanel {
    margin-right: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
button {
    background: #4b7bec;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 16px;
    margin: 5px;
    cursor: pointer;
}
#clearBtn {
    background: #fc5c65;
}
#output {
    margin-top: 10px;
    width: 400px;
    height: 220px;
    border-radius: 10px;
    border: 2px solid #ccc;
    background: #fff;
    padding: 10px;
    text-align: left;
    overflow-y: auto;
    white-space: pre-wrap;
    font-family: monospace;
}
</style>
</head>
<body>

<h2>ğŸ Python Blocks Runner Ù…Ø¹ Skulpt</h2>

<div id="main">
    <div id="blocklyDiv"></div>
    <div id="rightPanel">
        <button id="runBtn">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</button>
        <button id="clearBtn">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù†Ø§ØªØ¬</button>
        <div id="output"></div>
    </div>
</div>

<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Blockly
  var workspace = Blockly.inject('blocklyDiv', {
    toolbox: `
    <xml xmlns="https://developers.google.com/blockly/xml">
        <category name="Ø·Ø¨Ø§Ø¹Ø©" colour="#5CA699">
          <block type="text_print"></block>
        </category>
        <category name="Ù‚ÙŠÙ… ÙˆÙ†ØµÙˆØµ" colour="#5C81A6">
          <block type="math_number"></block>
          <block type="text"></block>
          <block type="variables_get"></block>
          <block type="variables_set"></block>
        </category>
        <category name="Ø§Ù„ØªØ­ÙƒÙ…" colour="#A65C81">
          <block type="controls_if"></block>
          <block type="controls_repeat_ext">
            <value name="TIMES"><shadow type="math_number"><field name="NUM">5</field></shadow></value>
          </block>
        </category>
        <category name="Ø§Ù„Ø¯ÙˆØ§Ù„" colour="#A6745C" custom="PROCEDURE"></category>
    </xml>
    `
  });

  // Ø¥Ø¹Ø¯Ø§Ø¯ Skulpt
  function outf(text) {
    var outputDiv = document.getElementById("output");
    outputDiv.innerHTML += text + "\n";
  }

  function runCode(code) {
    document.getElementById("output").innerHTML += "<hr>";
    Sk.configure({output:outf, read:builtinRead});
    (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'output';
    var myPromise = Sk.misceval.asyncToPromise(function() {
        return Sk.importMainWithBody("<stdin>", false, code, true);
    });
    myPromise.then(function(mod) {
        console.log("ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°");
    },
    function(err) {
        outf(err.toString());
    });
  }

  function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
        throw "Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: '" + x + "'";
    return Sk.builtinFiles["files"][x];
  }

  // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
  document.getElementById("runBtn").addEventListener("click", () => {
    var code = Blockly.Python.workspaceToCode(workspace);
    runCode(code);
  });

  // Ù…Ø³Ø­ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬
  document.getElementById("clearBtn").addEventListener("click", () => {
    document.getElementById("output").innerHTML = "";
  });
</script>

</body>
</html>
