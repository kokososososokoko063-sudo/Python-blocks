<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Python Blocks Runner â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©</title>

<!-- Ù…ÙƒØªØ¨Ø§Øª Blockly Ùˆ Brython -->
<script src="https://unpkg.com/blockly/blockly.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython_stdlib.js"></script>

<style>
  body {
    font-family: "Cairo", sans-serif;
    direction: rtl;
    background: #f5f6fa;
    margin: 0;
    text-align: center;
  }
  h2 {
    background: #4b7bec;
    color: white;
    margin: 0;
    padding: 15px;
  }
  #main {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin: 20px;
  }
  #blocklyDiv {
    height: 520px;
    width: 700px;
    border: 2px solid #ccc;
    border-radius: 10px;
    background: white;
  }
  #rightPanel {
    margin-right: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  button {
    background: #4b7bec;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 16px;
    margin: 5px;
    cursor: pointer;
  }
  #clearBtn { background: #fc5c65; }
  #output {
    margin-top: 10px;
    width: 400px;
    height: 220px;
    border-radius: 10px;
    border: 2px solid #ccc;
    background: #fff;
    padding: 10px;
    text-align: left;
    overflow-y: auto;
    white-space: pre-wrap;
    font-family: monospace;
  }
</style>
</head>

<body onload="brython()">
<h2>ğŸ Python Blocks Runner â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©</h2>

<div id="main">
  <div id="blocklyDiv"></div>
  <div id="rightPanel">
    <button id="runBtn">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</button>
    <button id="clearBtn">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù†Ø§ØªØ¬</button>
    <div id="output"></div>
  </div>
</div>

<!-- Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ù†Ø§Ø© Ø¥Ø®Ø±Ø§Ø¬ Ø¯Ø§Ø®Ù„ Ø¨Ø§ÙŠØ«ÙˆÙ† -->
<script type="text/python">
from browser import window

def run_python_code(code):
    output_el = window.document["output"]
    import io, sys
    buf = io.StringIO()
    sys.stdout = buf
    sys.stderr = buf
    try:
        exec(code)
    except Exception as e:
        print("âš ï¸ Ø®Ø·Ø£:", e)
    sys.stdout = sys.__stdout__
    sys.stderr = sys.__stderr__
    window.document["output"].innerHTML += "<pre>" + buf.getvalue() + "</pre>"
</script>

<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Blockly
  const workspace = Blockly.inject('blocklyDiv', {
    toolbox: `
      <xml xmlns="https://developers.google.com/blockly/xml">
        <category name="Ø·Ø¨Ø§Ø¹Ø©" colour="#5CA699">
          <block type="text_print"></block>
        </category>
        <category name="Ù‚ÙŠÙ… ÙˆÙ†ØµÙˆØµ" colour="#5C81A6">
          <block type="math_number"></block>
          <block type="text"></block>
        </category>
      </xml>
    `
  });

  // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
  document.getElementById('runBtn').addEventListener('click', () => {
    const pyCode = Blockly.Python.workspaceToCode(workspace);
    document.getElementById('output').innerHTML += "<hr><b>ØªØ´ØºÙŠÙ„:</b><br><pre>" + pyCode + "</pre>";
    try {
      // Ù†Ù†ÙØ° Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø¯Ø§Ø®Ù„ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù…Ø¨Ø§Ø´Ø±Ø©
      __BRYTHON__.run_script(`
from browser import window
window.run_python_code("""${pyCode.replaceAll('"','\\"')}""")
      `);
    } catch (err) {
      document.getElementById('output').innerHTML += `<span style='color:red'>âš ï¸ Ø®Ø·Ø£: ${err}</span><br>`;
    }
  });

  // Ù…Ø³Ø­ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬
  document.getElementById('clearBtn').addEventListener('click', () => {
    document.getElementById('output').innerHTML = '';
  });
</script>

</body>
</html>
